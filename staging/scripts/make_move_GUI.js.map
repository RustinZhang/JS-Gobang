{"version":3,"sources":["make_move_GUI.js"],"names":["move_fr_UI","document","querySelector","shade","choose_difficulty","retract","restart","addEventListener","e","target","classList","contains","max_dep","style","display","turn","color","console","log","posY","posX","innerHTML","push","convert","pos","getPlayerPos","undefined","remove","setTimeout","length","cmt_AI","terminate","Worker","add"],"mappings":"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","file":"make_move_GUI.js","sourcesContent":["/**\n * @fileOverview 玩家的所有操作的DOM操作由这个模块控制\n */\n\"use strict\";\n/**\n * @module make_move_GUI\n * @see module: init\n * @see module: shift_player\n */\n\nimport {step, virtual_b, steps_hist} from \"./init.js\";\nimport {shift, gui} from \"./shift_player.js\";\n\nlet move_fr_UI = document.querySelector(\".chess-move\"),\nshade = document.querySelector(\".shade\"),\nchoose_difficulty = document.querySelector(\".difficulty\"),\nretract = document.querySelector(\".retract\"),\nrestart = document.querySelector(\".restart\");\n\n// 玩家选择白色，电脑先手，事件回调一律使用箭头函数避免意外改变this\nchoose_difficulty.addEventListener(\"click\", (e) => {\n    if (e.target.classList.contains('choose-diff')) {\n        if (e.target.classList.contains('normal')) step.max_dep = 4;\n        if (e.target.classList.contains('easy')) step.max_dep = 2;\n        \n        shade.style.display = \"none\";\n        step.turn = true;\n        step.color = false;\n        console.log(\"AI begin to work\");\n        virtual_b[7][7] = 0;\n        step.posY = 7;\n        step.posX = 7;\n        document.querySelector(\".r7 .col7\").innerHTML = '<div class=\"stone-b\"></div>';\n        steps_hist.push([7, 7, false]);\n        shift.convert();\n    }\n});\n\n\n// 玩家落子\nmove_fr_UI.addEventListener(\"click\", (e) => {\n    if (e.target.classList.contains(\"column\") && !step.turn) {\n        let pos = gui.getPlayerPos(e.target);\n        if (virtual_b[pos[0]][pos[1]] === undefined) {\n            if (document.querySelector(\".new-step\"))\n                document.querySelector(\".new-step\").classList.remove(\"new-step\");\n            e.target.innerHTML = step.color ? '<div class=\"stone-w new-step\"></div>' : '<div class=\"stone-b new-step\"></div>';\n            virtual_b[pos[0]][pos[1]] = step.color ? 1 : 0;\n            [step.posY, step.posX] = pos;\n            steps_hist.push([pos[0], pos[1], step.color, false]);\n            setTimeout(() => {\n                shift.convert();\n            }, 0);\n        }\n    }\n});\n\n// 悔棋按钮\nretract.addEventListener(\"click\", () => {\n    if (steps_hist.length > 2) {\n        // 如果 AI 还在思考时玩家反悔，中止运算\n        if (step.turn) {\n            shift.cmt_AI.terminate();\n            shift.cmt_AI = new Worker(\"scripts/AI_worker.js\");\n        }\n        // 如果最后一步棋是 AI 下的，删两个子\n        if (steps_hist[steps_hist.length - 1][3]) {\n            gui.remove(2);\n        }\n        // 如果最后一步是玩家下的，删一个子\n        else {\n            gui.remove(1);\n        }\n        [step.posY, step.posX, step.color] = steps_hist[steps_hist.length - 1]\n        step.turn = true;\n        document.querySelector(`.r${steps_hist[steps_hist.length - 1][0]} .col${steps_hist[steps_hist.length - 1][1]}`).classList.add(\"new-step\");\n        shift.convert();\n    }\n});\n\n/**\n * @see module: shift_player.gui.restart\n */\n\nrestart.addEventListener(\"click\", gui.restart);\n\n\n\n\n\n  \n  \n  \n\n\n"]}